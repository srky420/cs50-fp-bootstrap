{% extends "layout.html" %}

{% block title %} Search {% endblock %}

{% block body %}

    <!-- Search result cards -->

    <div class="cards">
        <div class="heading cards-heading">Search results for "{{ title }}", page {{ response["page"] }} </div>
        <div class="cards-list-y">

            {% for result in response["results"] %}

                <!-- Filter only movies and tv shows having a poster -->

                {% if (result["media_type"] == "movie" or result["media_type"] == "tv") and result["poster_path"] %}

                <div class="card-x">

                    <!-- Check for type -->

                    {% if result["media_type"] == "movie" %}   
                    <form action="/movie/{{ result['id'] }}" method="get">                
                        <input class="search-card-img" type="image" src="http://image.tmdb.org/t/p/w500/{{ result['poster_path'] }}" alt="Poster" onclick="this.submit();">
                    </form>   
                    {% else %}  
                    <form action="/show/{{ result['id'] }}" method="get">           
                        <input class="search-card-img" type="image" src="http://image.tmdb.org/t/p/w500/{{ result['poster_path'] }}" alt="Poster" onclick="this.submit();">  
                    </form>                      
                    {% endif %}

                    <div class="info-x">

                        <!-- Check for type -->

                        {% if result["title"] %}
                        <form action="/movie/{{ result['id'] }}" method="get"> 
                            <h3 class="text-w title" onclick="this.parentNode.submit()"> {{ result["title"] }} </h3>
                        </form> 
                        {% else %}
                        <form action="/show/{{ result['id'] }}" method="get">
                            <h3 class="text-w title" onclick="this.parentNode.submit()"> {{ result["name"] }} </h3>
                        </form>
                        {% endif %}

                        <div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-star-fill" viewBox="0 0 16 16">
                                <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                            </svg> {{ "%0.1f" | format(result["vote_average"]) }}
                        </div>

                        <!-- Check for type -->

                        {% if result["media_type"] == "movie" %}
                            <p class="text-g">Movie</p>
                        {% else %}
                            <p class="text-g">Season</p>
                        {% endif %}

                        <!-- Check for type -->

                        {% if result["release_date"] %}
                            <p class="text-g"> {{ result["release_date"] }} </p>
                        {% else %}
                            <p class="text-g"> {{ result["first_air_date"] }} </p>
                        {% endif %}

                    </div>
                    
                </div>

                {% endif %}

            {% endfor %}

        </div>
    </div>

    <!-- Pagination -->

    <div class="pagination">
        
        {% if response["total_pages"] > 4 %}
        
            <!-- First page condition -->
            {% if response["page"] == 1 %}

                <a href="#" id="active-link">1</a>
                <a href="/search?search={{ title }}&page={{ response['page'] + 1 }}">{{ response["page"] + 1 }}</a>
                <a href="/search?search={{ title }}&page={{ response['page'] + 2 }}">{{ response["page"] + 2 }}</a>
                <p class="text-g">...</p>
                <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

            <!-- Last page condition -->
            {% elif response["page"] == response["total_pages"] %}

                <a href="/search?search={{ title }}&page=1">1</a>
                <p class="text-g">...</p>
                <a href="/search?search={{ title }}&page={{ response['page'] - 2 }}">{{ response["page"] - 2 }}</a>
                <a href="/search?search={{ title }}&page={{ response['page'] - 1 }}">{{ response["page"] - 1 }}</a>
                <a href="#" id="active-link">{{ response["total_pages"] }}</a>

            <!-- Second page condition -->
            {% elif response["page"] - 1 == 1 %}

                <a href="/search?search={{ title }}&page=1">1</a>
                <a href="#" id="active-link">{{ response["page"] }}</a>
                <a href="/search?search={{ title }}&page={{ response['page'] + 1 }}">{{ response["page"] + 1 }}</a>
                <a href="/search?search={{ title }}&page={{ response['page'] + 2 }}">{{ response["page"] + 2 }}</a>
                <p class="text-g">...</p>
                <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

            <!-- Second last page condition -->
            {% elif response["page"] + 1 == response["total_pages"] %}

                <a href="/search?search={{ title }}&page=1">1</a>
                <p class="text-g">...</p>
                <a href="/search?search={{ title }}&page={{ response['page'] - 2 }}">{{ response["page"] - 2 }}</a>
                <a href="/search?search={{ title }}&page={{ response['page'] - 1 }}">{{ response["page"] - 1 }}</a>
                <a href="#" id="active-link">{{ response["page"] }}</a>
                <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>
            
            <!-- Middle page condition -->
            {% else %}

                <a href="/search?search={{ title }}&page=1">1</a>
                <p class="text-g">...</p>
                <a href="/search?search={{ title }}&page={{ response['page'] - 1 }}">{{ response["page"] - 1 }}</a>
                <a href="#" id="active-link">{{ response["page"] }}</a>
                <a href="/search?search={{ title }}&page={{ response['page'] + 1 }}">{{ response["page"] + 1 }}</a>
                <p class="text-g">...</p>
                <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

            {% endif %}

        <!-- For 4 pages -->
        {% elif response["total_pages"] == 4 %}

            <!-- First page condition -->
            {% if response["page"] == 1 %}

                <a href="#" id="active-link">1</a>
                <a href="/search?search={{ title }}&page={{ response['page'] + 1 }}">{{ response["page"] + 1 }}</a>
                <a href="/search?search={{ title }}&page={{ response['page'] + 2 }}">{{ response["page"] + 2 }}</a>
                <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

            <!-- Last page condition -->
            {% elif response["page"] == response["total_pages"] %}

                <a href="/search?search={{ title }}&page=1">1</a>
                <a href="/search?search={{ title }}&page={{ response['page'] - 2 }}">{{ response["page"] - 2 }}</a>
                <a href="/search?search={{ title }}&page={{ response['page'] - 1 }}">{{ response["page"] - 1 }}</a>
                <a href="#" id="active-link">{{ response["total_pages"] }}</a>

            <!-- Second page condition -->
            {% elif response["page"] - 1 == 1 %}

                <a href="/search?search={{ title }}&page=1">1</a>
                <a href="#" id="active-link">{{ response["page"] }}</a>
                <a href="/search?search={{ title }}&page={{ response['page'] + 1 }}">{{ response["page"] + 1 }}</a>
                <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

            <!-- Second last page condition -->
            {% elif response["page"] + 1 == response["total_pages"] %}

                <a href="/search?search={{ title }}&page=1">1</a>
                <a href="/search?search={{ title }}&page={{ response['page'] - 1 }}">{{ response["page"] - 1 }}</a>
                <a href="#" id="active-link">{{ response["page"] }}</a>
                <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>
                    
            {% endif %}

        <!-- For 3 pages -->
        {% elif response["total_pages"] == 3 %}

            <!-- First page condition -->
            {% if response["page"] == 1 %}

                <a href="#" id="active-link">1</a>
                <a href="/search?search={{ title }}&page={{ response['page'] + 1 }}">{{ response["page"] + 1 }}</a>
                <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

            <!-- Second page condition -->
            {% elif response["page"] - 1 == 1 %}

                <a href="/search?search={{ title }}&page=1">1</a>
                <a href="#" id="active-link">{{ response["page"] }}</a>
                <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

            <!-- Last page condition -->
            {% else %}

                <a href="/search?search={{ title }}&page=1">1</a>
                <a href="/search?search={{ title }}&page={{ response['page'] - 1 }}">{{ response["page"] - 1 }}</a>
                <a href="#" id="active-link">{{ response["total_pages"] }}</a>

            {% endif %}

        <!-- For 2 pages -->
        {% elif response["total_pages"] == 2 %}

            <!-- First page condition -->
            {% if response["page"] == 1 %}

            <a href="#" id="active-link">1</a>
            <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

            <!-- Last page condition -->
            {% else %}

            <a href="/search?search={{ title }}&page=1">1</a>
            <a href="#" id="active-link">{{ response["total_pages"] }}</a>

            {% endif %}

        {% endif %}
        
    </div>

{% endblock %}