{% extends "layout.html" %}

{% block title %} Search {% endblock %}

{% block body %}

<!-- Search result cards -->
<div class="container-sm w-75 my-5 bg-body-tertiary border rounded-3 h-100">
    <p class="h5 text-muted my-3">Search result for "{{ title }}":</p>
    <!-- Filter only movies and tv shows having a poster -->
    {% for result in response["results"] %}
    {% if (result["media_type"] == "movie" or result["media_type"] == "tv") and result["poster_path"] %}
    <div class="card mb-3 w-100 my-3">
        <div class="row g-0">
            <div class="col-3 col-md-2 col-lg-1 my-auto">
                <img src="http://image.tmdb.org/t/p/w154/{{ result['poster_path'] }}" class="img-thumbnail rounded-start"
                    alt="Poster">
            </div>
            <div class="col-12 col-md-10 col-lg-8">
                <div class="card-body">
                    <h6 class="card-title m-0">
                        {% if result["title"] %}
                        <a class="card-link" href=""> {{ result["title"] }}</a>
                        {% else %}
                        <a class="card-link" href=""> {{ result["name"] }}</a>
                        {% endif %}
                    </h6>
                    <p class="card-text m-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="yellow"
                            class="bi bi-star-fill" viewBox="0 2 16 16">
                            <path
                                d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                        </svg> {{ "%0.1f" | format(result["vote_average"]) }}
                    </p>
                    <div class="card-text">
                        <small class="text-muted">
                            {% if result["media_type"] == "movie" %}
                            <p class="m-0">Movie</p>
                            {% else %}
                            <p class="m-0">Season</p>
                            {% endif %}
                        </small>
                    </div>
                    <div class="card-text m-0">
                        <small class="text-muted">
                            {% if result["release_date"] %}
                            <p>{{ result["release_date"] }}</p>
                            {% else %}
                            <p>{{ result["first_air_date"] }}</p>
                            {% endif %}
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    {% endfor %}
</div>



<!-- Pagination -->

<div class="pagination">

    {% if response["total_pages"] > 4 %}

    <!-- First page condition -->
    {% if response["page"] == 1 %}

    <a href="#" id="active-link">1</a>
    <a href="/search?search={{ title }}&page={{ response['page'] + 1 }}">{{ response["page"] + 1 }}</a>
    <a href="/search?search={{ title }}&page={{ response['page'] + 2 }}">{{ response["page"] + 2 }}</a>
    <p class="text-g">...</p>
    <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

    <!-- Last page condition -->
    {% elif response["page"] == response["total_pages"] %}

    <a href="/search?search={{ title }}&page=1">1</a>
    <p class="text-g">...</p>
    <a href="/search?search={{ title }}&page={{ response['page'] - 2 }}">{{ response["page"] - 2 }}</a>
    <a href="/search?search={{ title }}&page={{ response['page'] - 1 }}">{{ response["page"] - 1 }}</a>
    <a href="#" id="active-link">{{ response["total_pages"] }}</a>

    <!-- Second page condition -->
    {% elif response["page"] - 1 == 1 %}

    <a href="/search?search={{ title }}&page=1">1</a>
    <a href="#" id="active-link">{{ response["page"] }}</a>
    <a href="/search?search={{ title }}&page={{ response['page'] + 1 }}">{{ response["page"] + 1 }}</a>
    <a href="/search?search={{ title }}&page={{ response['page'] + 2 }}">{{ response["page"] + 2 }}</a>
    <p class="text-g">...</p>
    <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

    <!-- Second last page condition -->
    {% elif response["page"] + 1 == response["total_pages"] %}

    <a href="/search?search={{ title }}&page=1">1</a>
    <p class="text-g">...</p>
    <a href="/search?search={{ title }}&page={{ response['page'] - 2 }}">{{ response["page"] - 2 }}</a>
    <a href="/search?search={{ title }}&page={{ response['page'] - 1 }}">{{ response["page"] - 1 }}</a>
    <a href="#" id="active-link">{{ response["page"] }}</a>
    <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

    <!-- Middle page condition -->
    {% else %}

    <a href="/search?search={{ title }}&page=1">1</a>
    <p class="text-g">...</p>
    <a href="/search?search={{ title }}&page={{ response['page'] - 1 }}">{{ response["page"] - 1 }}</a>
    <a href="#" id="active-link">{{ response["page"] }}</a>
    <a href="/search?search={{ title }}&page={{ response['page'] + 1 }}">{{ response["page"] + 1 }}</a>
    <p class="text-g">...</p>
    <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

    {% endif %}

    <!-- For 4 pages -->
    {% elif response["total_pages"] == 4 %}

    <!-- First page condition -->
    {% if response["page"] == 1 %}

    <a href="#" id="active-link">1</a>
    <a href="/search?search={{ title }}&page={{ response['page'] + 1 }}">{{ response["page"] + 1 }}</a>
    <a href="/search?search={{ title }}&page={{ response['page'] + 2 }}">{{ response["page"] + 2 }}</a>
    <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

    <!-- Last page condition -->
    {% elif response["page"] == response["total_pages"] %}

    <a href="/search?search={{ title }}&page=1">1</a>
    <a href="/search?search={{ title }}&page={{ response['page'] - 2 }}">{{ response["page"] - 2 }}</a>
    <a href="/search?search={{ title }}&page={{ response['page'] - 1 }}">{{ response["page"] - 1 }}</a>
    <a href="#" id="active-link">{{ response["total_pages"] }}</a>

    <!-- Second page condition -->
    {% elif response["page"] - 1 == 1 %}

    <a href="/search?search={{ title }}&page=1">1</a>
    <a href="#" id="active-link">{{ response["page"] }}</a>
    <a href="/search?search={{ title }}&page={{ response['page'] + 1 }}">{{ response["page"] + 1 }}</a>
    <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

    <!-- Second last page condition -->
    {% elif response["page"] + 1 == response["total_pages"] %}

    <a href="/search?search={{ title }}&page=1">1</a>
    <a href="/search?search={{ title }}&page={{ response['page'] - 1 }}">{{ response["page"] - 1 }}</a>
    <a href="#" id="active-link">{{ response["page"] }}</a>
    <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

    {% endif %}

    <!-- For 3 pages -->
    {% elif response["total_pages"] == 3 %}

    <!-- First page condition -->
    {% if response["page"] == 1 %}

    <a href="#" id="active-link">1</a>
    <a href="/search?search={{ title }}&page={{ response['page'] + 1 }}">{{ response["page"] + 1 }}</a>
    <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

    <!-- Second page condition -->
    {% elif response["page"] - 1 == 1 %}

    <a href="/search?search={{ title }}&page=1">1</a>
    <a href="#" id="active-link">{{ response["page"] }}</a>
    <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

    <!-- Last page condition -->
    {% else %}

    <a href="/search?search={{ title }}&page=1">1</a>
    <a href="/search?search={{ title }}&page={{ response['page'] - 1 }}">{{ response["page"] - 1 }}</a>
    <a href="#" id="active-link">{{ response["total_pages"] }}</a>

    {% endif %}

    <!-- For 2 pages -->
    {% elif response["total_pages"] == 2 %}

    <!-- First page condition -->
    {% if response["page"] == 1 %}

    <a href="#" id="active-link">1</a>
    <a href="/search?search={{ title }}&page={{ response['total_pages'] }}">{{ response["total_pages"] }}</a>

    <!-- Last page condition -->
    {% else %}

    <a href="/search?search={{ title }}&page=1">1</a>
    <a href="#" id="active-link">{{ response["total_pages"] }}</a>

    {% endif %}

    {% endif %}

</div>

{% endblock %}